<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/consulta.css">
    <title>Consulta de atendimentos</title>
</head>

<body>
    <header>
    <nav>
        <ul>
            <li><a id="agendar" href="/">Agendar um Atendimento</a></li>
            <li class="direita"><a id="consultar" href="/tabela">Consultar Atendimentos</a></li>
        </ul>
    </nav>
</header>

    <div class="filtros">
        
    <input type="text" id="pesquisa" placeholder="Buscar por OS, nome..." />
    <form method="get" action="/tabela">
        <label for="semana">Escolha a semana:</label>
        <select name="semana" id="semana" onchange="this.form.submit()">
            {% for s in semanas_disponiveis %}
            {% set s_fim = s + timedelta(days=4) %}
            <option value="{{ s.strftime('%Y-%m-%d') }}" {% if semana==s.strftime('%Y-%m-%d') %}selected{% endif %}>
                Semana {{ s.strftime('%d/%m') }} - {{ s_fim.strftime('%d/%m') }}
            </option>
            {% endfor %}
        </select>
    </form>
    </div>

    <table border="1" id="tabela">
        <thead>
            <tr>
                <th>TÃ©cnico</th>
                <th>Data</th>
                <th>OS</th>
                <th>Cliente</th>
                <th>Modelo</th>
                <th>Hora</th>
                <th>Tipo</th>
            </tr>
        </thead>
        <tbody>
            {% for tecnico in tecnicos %}
            {% for dia in dias_semana %}
            {% set ags = agendamentos[tecnico][dia] %}
            {% if ags %}
            {% for ag in ags %}
            <tr class="{{ ag.tipo | lower }}">
                <td class="nome-tecnico tecnico-{{ tecnico | lower | replace(' ', '-') }}">
                    {{ tecnico }}
                </td>

                {# Mostra a data apenas na primeira linha do dia #}
                {% if loop.index0 == 0 %}
                <td rowspan="{{ ags | length }}">{{ dia.strftime('%d/%m') }}</td>
                {% endif %}

                <td>{{ ag.os }}</td>
                <td>
                    {{ ag.cliente }}
                    <button class="btn-apagar" data-id="{{ ag.id }}">x</button>
                </td>
                <td>{{ ag.modelo }}</td>
                <td>{{ ag.hora }}</td>
                <td>{{ ag.tipo }}</td>
            </tr>
            {% endfor %}
            {% else %}
            <tr class="vazio">
                <td class="nome-tecnico tecnico-{{ tecnico | lower | replace(' ', '-') }}">
                    {{ tecnico }}
                </td>
                <td>{{ dia.strftime('%d/%m') }}</td>
                <td colspan="5">vazio</td>
            </tr>
            {% endif %}
            {% endfor %}
            {% endfor %}
        </tbody>
    </table>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>

</html>